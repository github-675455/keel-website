

  <!DOCTYPE html>
  <html lang="en">

  <head>
    <title>
      Enabling automated updates —  Keel </title>
    <meta charset="utf-8">
    <meta name="description" content="Fully automated, policy driven continuous deployment solution for Kubernetes">    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta property="og:type" content="article">
    <meta property="og:title" content="Enabling automated updates —  Keel">
    <meta property="og:description" content="How to automatically update your app -  Keel">
    <meta property="og:image" content="https://keel.sh/images/logo.png ">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Enabling automated updates — Web Relay">
    <meta name="twitter:description" content="Fully automated, policy driven continuous deployment solution for Kubernetes">
    <meta name="twitter:image" content="https://keel.sh/images/logo.png">

    <link rel="apple-touch-icon" sizes="57x57" href="/ /images/icons/apple-icon-57x57.png ">
    <link rel="apple-touch-icon" sizes="60x60" href="/ /images/icons/apple-icon-60x60.png ">
    <link rel="apple-touch-icon" sizes="72x72" href="/ /images/icons/apple-icon-72x72.png ">
    <link rel="apple-touch-icon" sizes="76x76" href="/ /images/icons/apple-icon-76x76.png ">
    <link rel="apple-touch-icon" sizes="114x114" href="/ /images/icons/apple-icon-114x114.png ">
    <link rel="apple-touch-icon" sizes="120x120" href="/ /images/icons/apple-icon-120x120.png ">
    <link rel="apple-touch-icon" sizes="144x144" href="/ /images/icons/apple-icon-144x144.png ">
    <link rel="apple-touch-icon" sizes="152x152" href="/ /images/icons/apple-icon-152x152.png ">
    <link rel="apple-touch-icon" sizes="180x180" href="/ /images/icons/apple-icon-180x180.png ">
    <link rel="icon" type="image/png" sizes="192x192" href="/ /images/icons/android-icon-192x192.png ">
    <link rel="icon" type="image/png" sizes="32x32" href="/ /images/icons/favicon-32x32.png ">
    <link rel="icon" type="image/png" sizes="96x96" href="/ /images/icons/favicon-96x96.png ">
    <link rel="icon" type="image/png" sizes="16x16" href="/ /images/icons/favicon-16x16.png ">
    <meta name="msapplication-TileImage" content="/images/icons/ms-icon-144x144.png">
    <link rel="icon" href="/images/logo.png" type="image/png">

    <meta name="msapplication-TileColor" content="#2979ff">
    <meta name="theme-color" content="#2979ff">

    <meta name="msapplication-config" content="browserconfig.xml">
    <link rel="manifest" href="/manifest.json">    

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Roboto Mono' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Dosis:500&text=Vue.js' rel='stylesheet' type='text/css'>

    <!-- main page styles -->
    <link rel="stylesheet" href="/css/page.css">

    <!-- this needs to be loaded before guide's inline scripts -->      
    <script>window.PAGE_TYPE = "examples"</script>    

    <!-- ga -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-103394074-1', 'auto');
      ga('send', 'pageview');

    </script>    
  </head>

  <body class="docs">
    <div id="mobile-bar" >
      <a class="menu-button"></a>
      <a class="logo" href="/"></a>
    </div>
    <div id="header">
  <a id="logo" href="/">
    <img src="/images/logo.png">
    <span>Keel</span>
  </a>
  <ul id="nav">
    <!-- <li>
  <form id="search-form">
    <input type="text" id="search-query-nav" class="search-query st-default-search-input">
  </form>
</li>
-->
<li class="nav-dropdown-container learn">
  <a class="nav-link current">Learn</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><ul>
      <li><a href="/v1/guide/" class="nav-link">Guide</a></li>
      <!-- <li><a href="/v1/api/" class="nav-link">API</a></li> -->
      <li><a href="/v1/examples/" class="nav-link current">Examples</a></li>
    </ul></li>
  </ul>
</li>

<li class="nav-dropdown-container ecosystem">
  <a class="nav-link">Ecosystem</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><h4>Help</h4></li>
    <li><ul>
      <li><a href="mailto:info@webhookrelay.com" class="nav-link" rel="nofollow">Email</a></li>            
      <li><a href="https://github.com/keel-hq/keel/issues" class="nav-link" target="_blank" rel="noopener">Issue Tracker</a></li>            
    </ul></li>
    <li><h4>Tooling</h4></li>
    <li>
      <ul>        
        <li><a href="https://hub.docker.com/r/keelhq/keel/" class="nav-link" target="_blank" rel="noopener">Docker Image</a></li>
        
      </ul>
    </li>    
    <li><h4>News</h4></li>
    <li><ul>
      <li><a href="https://twitter.com/keel_hq" class="nav-link" target="_blank" rel="noopener">Twitter</a></li>      
    </ul></li>
    <li><h4>Resource Lists</h4></li>
    <li><ul>
      <li><a href="https://github.com/keel-hq" class="nav-link" target="_blank" rel="noopener">Official Repos</a></li>            
    </ul></li>
  </ul>
</li>


<!-- <li>
  <a href="/blog/" class="nav-link team">Blog</a>
</li> -->
<li>
  <a href="/support/index.html" class="nav-link team">Support</a>
</li>
<li>
  <a class="nav-link team" target="_blank" href="https://github.com/keel-hq/keel">Github →</a>
</li>

  </ul>
</div>

      
        <div id="main" class="fix-sidebar">
          
                
  <div class="sidebar">
  <div class="sidebar-inner">
    <ul class="main-menu">
      <!-- <li>
  <form id="search-form">
    <input type="text" id="search-query-sidebar" class="search-query st-default-search-input">
  </form>
</li>
-->
<li class="nav-dropdown-container learn">
  <a class="nav-link current">Learn</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><ul>
      <li><a href="/v1/guide/" class="nav-link">Guide</a></li>
      <!-- <li><a href="/v1/api/" class="nav-link">API</a></li> -->
      <li><a href="/v1/examples/" class="nav-link current">Examples</a></li>
    </ul></li>
  </ul>
</li>

<li class="nav-dropdown-container ecosystem">
  <a class="nav-link">Ecosystem</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><h4>Help</h4></li>
    <li><ul>
      <li><a href="mailto:info@webhookrelay.com" class="nav-link" rel="nofollow">Email</a></li>            
      <li><a href="https://github.com/keel-hq/keel/issues" class="nav-link" target="_blank" rel="noopener">Issue Tracker</a></li>            
    </ul></li>
    <li><h4>Tooling</h4></li>
    <li>
      <ul>        
        <li><a href="https://hub.docker.com/r/keelhq/keel/" class="nav-link" target="_blank" rel="noopener">Docker Image</a></li>
        
      </ul>
    </li>    
    <li><h4>News</h4></li>
    <li><ul>
      <li><a href="https://twitter.com/keel_hq" class="nav-link" target="_blank" rel="noopener">Twitter</a></li>      
    </ul></li>
    <li><h4>Resource Lists</h4></li>
    <li><ul>
      <li><a href="https://github.com/keel-hq" class="nav-link" target="_blank" rel="noopener">Official Repos</a></li>            
    </ul></li>
  </ul>
</li>


<!-- <li>
  <a href="/blog/" class="nav-link team">Blog</a>
</li> -->
<li>
  <a href="/support/index.html" class="nav-link team">Support</a>
</li>
<li>
  <a class="nav-link team" target="_blank" href="https://github.com/keel-hq/keel">Github →</a>
</li>

    </ul>
    <div class="list">      
      <h2>
        Examples
        
          <select class="version-select">
            <option value="SELF" selected>1.x</option>
          </select>
        
      </h2>
      <ul class="menu-root">
  
    
    
    
    <li>
      <a href="/v1/examples/index.html" class="sidebar-link">Examples</a>
    </li>
  
    
    
    
    <li>
      <a href="/v1/examples/enabling-auto-updates.html" class="sidebar-link current">Enabling automated updates</a>
    </li>
  
    
    
    
    <li>
      <a href="/v1/examples/push-to-deploy.html" class="sidebar-link">Setting up "push to deploy" workflow</a>
    </li>
  
  
</ul>

    </div>
  </div>
</div>


<div class="content examples with-sidebar ">
  
    
  
  
    <h1>Enabling automated updates</h1>
  
  <p>Once in a while (or more often) you need to update your application that’s running in a cloud-native fashion inside Kubernetes.</p>
<p>Let’s see how easy it is to do it with Keel.</p>
<p><img src="/images/keel-quick-start.png" alt="Keel Quick Start"></p>
<h2 id="Install-Keel"><a href="#Install-Keel" class="headerlink" title="Install Keel"></a>Install Keel</h2><p>Installing Keel is the first step, as long as no update policies are defined in your application deployment files or Helm Charts, Keel will ignore them.<br>You can choose your preferred installation type (kubectl or Helm) to deploy Keel, more details are available <a href="/v1/guide/installation.html">here</a>.</p>
<h2 id="Specify-update-policy"><a href="#Specify-update-policy" class="headerlink" title="Specify update policy"></a>Specify update policy</h2><p>Our example app is ‘webhook-demo’ which pretty much doesn’t do anything except registering incoming webhooks and showing them. Deployment file can be found here: <a href="https://github.com/webhookrelay/webhook-demo/blob/master/hack/deployment.yml" target="_blank" rel="noopener">https://github.com/webhookrelay/webhook-demo/blob/master/hack/deployment.yml</a>.</p>
<p>While traditional deployment manifest would look like this:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span> </span><br><span class="line"><span class="attr">  name:</span> <span class="string">wd</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">  labels:</span> </span><br><span class="line"><span class="attr">      name:</span> <span class="string">"wd"</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">wd</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">wd</span>        </span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span>                    </span><br><span class="line"><span class="attr">        - image:</span> <span class="string">karolisr/webhook-demo:0.0.8</span></span><br><span class="line"><span class="attr">          imagePullPolicy:</span> <span class="string">Always</span>            </span><br><span class="line"><span class="attr">          name:</span> <span class="string">wd</span></span><br><span class="line"><span class="attr">          command:</span> <span class="string">["/bin/webhook-demo"]</span></span><br><span class="line"><span class="attr">          ports:</span></span><br><span class="line"><span class="attr">            - containerPort:</span> <span class="number">8090</span>       </span><br><span class="line"><span class="attr">          livenessProbe:</span></span><br><span class="line"><span class="attr">            httpGet:</span></span><br><span class="line"><span class="attr">              path:</span> <span class="string">/healthz</span></span><br><span class="line"><span class="attr">              port:</span> <span class="number">8090</span></span><br><span class="line"><span class="attr">            initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line"><span class="attr">            timeoutSeconds:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>
<p>We need to add Keel policy for updates and optional trigger type.</p>
<p>These settings have to be specified as labels:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">keel.sh/policy: major</span><br><span class="line">keel.sh/trigger: poll</span><br></pre></td></tr></table></figure>
<p>Here:</p>
<ul>
<li><strong>keel.sh/policy: major</strong> specifies that all - major, minor and patch versions should trigger application update.</li>
<li><strong>keel.sh/trigger: poll</strong> informs Keel to create an active watcher for the repository that’s specified in the deployment file. For private repositories Keel will use existing secrets that Kubernetes uses to pull the image so no additional configuration required. Polling trigger is useful when webhooks or GCR pubsub is not availabe. If you have PUBSUB enabled for your cluster, then you shouldn’t use polling trigger.</li>
</ul>
<p>Now, our deployment file looks like this:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span> </span><br><span class="line"><span class="attr">  name:</span> <span class="string">wd</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">  labels:</span> </span><br><span class="line"><span class="attr">      name:</span> <span class="string">"wd"</span></span><br><span class="line">      <span class="string">keel.sh/policy:</span> <span class="string">major</span></span><br><span class="line">      <span class="string">keel.sh/trigger:</span> <span class="string">poll</span>      </span><br><span class="line"><span class="attr">  annotations:</span></span><br><span class="line">      <span class="comment"># keel.sh/pollSchedule: "@every 10m"</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">wd</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">wd</span>        </span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span>                    </span><br><span class="line"><span class="attr">        - image:</span> <span class="string">karolisr/webhook-demo:0.0.8</span></span><br><span class="line"><span class="attr">          imagePullPolicy:</span> <span class="string">Always</span>            </span><br><span class="line"><span class="attr">          name:</span> <span class="string">wd</span></span><br><span class="line"><span class="attr">          command:</span> <span class="string">["/bin/webhook-demo"]</span></span><br><span class="line"><span class="attr">          ports:</span></span><br><span class="line"><span class="attr">            - containerPort:</span> <span class="number">8090</span>       </span><br><span class="line"><span class="attr">          livenessProbe:</span></span><br><span class="line"><span class="attr">            httpGet:</span></span><br><span class="line"><span class="attr">              path:</span> <span class="string">/healthz</span></span><br><span class="line"><span class="attr">              port:</span> <span class="number">8090</span></span><br><span class="line"><span class="attr">            initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line"><span class="attr">            timeoutSeconds:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">          securityContext:</span></span><br><span class="line"><span class="attr">            privileged:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>That’s it, we update our deployment with new labels, if you already have your app deployed:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kubectl apply -f your-app-deployment.yaml</span><br></pre></td></tr></table></figure>
<p>And then wait for a few minutes till Keel picks up the changes. </p>

    
  <div class="footer">  
    Caught a mistake or want to contribute to the documentation?
    <a href="https://github.com/keel-hq/keel-website/blob/master/src/v1/examples/enabling-auto-updates.md" target="_blank">
      Edit this page on GitHub!
    </a>
  </div>
</div>

                  
        </div>
        <script src="/js/smooth-scroll.min.js"></script>
                      

      <!-- main custom script for sidebars, version selects etc. -->
      <script src="/js/css.escape.js"></script>
      <script src="/js/jquery.min.js"></script>
      <script src="/js/common.js"></script>                          
        
      <!-- fastclick -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
      <script>
        document.addEventListener('DOMContentLoaded', function () {
          FastClick.attach(document.body)
        }, false)
      </script>
  </body>

  </html>